ngApp.controller("membersCtrl",["$scope","$rootScope","$timeout","$http","$location","$state","$window",function(e,a,t,o,r,i,n){var l,m;e.rootURL="http://192.168.1.135:8000/crud/",e.imageURL="http://192.168.1.135/myFirstNodeJs/uploads/",e.allMembersList=[],e.updateEmpDetailIs=!1,e.imageFileObj={},e.membersObj={name:"",empId:"",gender:"male",department:""},e.goBackFun=function(){n.history.back()},e.getAllEmpList=function(){o({method:"GET",url:e.rootURL+"getEmpList",headers:{"Content-Type":"application/json"}}).then(function(t){if(e.allMembersList=[],t.data.success){var o=t.data.data;for(let a=0;a<o.length;a++)""!=o[a].image&&(o[a].image=e.imageURL+o[a].image),e.allMembersList.push(o[a])}else alert("Error :"+t.data.message);a.separateLoaderIs=!1})},e.getAllEmpList(),e.imageUploading=function(){$("#croppingContainer").show(),l=document.getElementById("imageCroppingBox");var e=document.getElementById("profilePhotoUploader").files[0],a=URL.createObjectURL(e);m=new Croppie(l,{viewport:{width:150,height:150,type:"circle"},boundary:{width:200,height:200},showZoomer:!1}),m.bind({url:a,orientation:4})},e.destroyTheCropping=function(){m.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer").hide()},e.cancelAll=function(){$("#croppedImageViewer").hide(),$("#photoUploadingLabel").show(),e.imageFileObj={}},e.getCroppedImage=function(){m.result("base64").then(function(e){$("#croppedImageViewer img").attr("src",e)}),m.result("blob").then(function(a){e.imageFileObj=a}),m.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer, #photoUploadingLabel").hide(),$("#croppedImageViewer").show()},e.addAndUpdateEmp=function(){if(""!=e.membersObj.name&&null!=e.membersObj.name&&""!=e.membersObj.empId&&null!=e.membersObj.empId&&""!=e.membersObj.department&&null!=e.membersObj.department){a.separateLoaderIs=!0;var t=angular.copy(e.membersObj),r="";e.updateEmpDetailIs?(t.emp_id=t.id,r="updateEmployee"):r="createNewEmployee",o({method:"POST",url:e.rootURL+r,headers:{"Content-Type":"application/json"},data:t}).then(function(a){a.data.success?e.profileImageUploading(a.data.data,a.data.message):alert("Error :"+a.data.message)},function(e){a.separateLoaderIs=!1,console.log("error",e)})}else alert("Fill the all info...")},e.profileImageUploading=function(t,r){if(""!=e.imageFileObj.type&&null!=e.imageFileObj.type){var i=e.membersObj.name.split(" "),n=i.join("_")+".png",l=new File([e.imageFileObj],n),m=new FormData;m.append("File",l),m.append("emp_id",t),o.post(e.rootURL+"uploadImage",m,{transformRequest:angular.identity,headers:{"Content-Type":void 0},async:!1}).then(function(t){t.data.success?(e.getAllEmpList(),alert(r),$("#memberAddModal").modal("hide")):alert(t.data.message),a.separateLoaderIs=!1},function(e){a.separateLoaderIs=!1,console.log("error",e)})}else e.getAllEmpList(),alert(r),$("#memberAddModal").modal("hide")},e.editAndAddEmp=function(a){e.imageFileObj={},"add"==a?(e.membersObj.name="",e.membersObj.empId="",e.membersObj.gender="male",e.membersObj.department="",e.updateEmpDetailIs=!1,$("#memberAddModal").modal("show")):(""!=a.image&&($("#croppedImageViewer img").attr("src",a.image),$("#croppingContainer, #photoUploadingLabel").hide(),$("#croppedImageViewer").show()),e.updateEmpDetailIs=!0,e.membersObj=angular.copy(a),$("#memberAddModal").modal("show"))},e.deleteEmp=function(t){confirm("Do you want to delete this person?")&&(a.separateLoaderIs=!0,o({method:"GET",url:e.rootURL+"deleteEmployee?emp_id="+t,headers:{"Content-Type":"application/json"}}).then(function(a){a.data.success?(alert(a.data.message),e.getAllEmpList()):alert("Error :"+a.data.message)}))},$("#memberAddModal").on("hide.bs.modal",function(a){$("#profilePhotoUploader").val()&&(m.destroy(),e.imageFileObj={},$("#profilePhotoUploader").val(null)),$("#croppingContainer, #croppedImageViewer").hide(),$("#photoUploadingLabel").show()})}]);