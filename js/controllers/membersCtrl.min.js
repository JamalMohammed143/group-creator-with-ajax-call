ngApp.controller("membersCtrl",["$scope","$rootScope","$timeout","$http","$location","$state","$window",function(e,a,t,o,r,l,i){var n,d;e.rootURL="http://192.168.1.135:8000/crud/",e.imageURL="http://192.168.1.135/group-creator-backend/uploads/",a.separateLoaderIs=!1,e.allMembersList=[],e.updateEmpDetailIs=!1,e.imageFileObj={},e.membersObj={name:"",empId:"",gender:"male",department:""},e.loginCheck(),e.goBackFun=function(){i.history.back()},e.getAllEmpList=function(){o({method:"GET",url:e.rootURL+"getEmpList",headers:{"Content-Type":"application/json"}}).then(function(t){if(e.allMembersList=[],t.data.success){var o=t.data.data;for(let a=0;a<o.length;a++)""!=o[a].image&&null!=o[a].image&&(o[a].imageFullPath=e.imageURL+o[a].image),e.allMembersList.push(o[a])}else alert("Error :"+t.data.message);a.separateLoaderIs=!1})},e.getAllEmpList(),e.imageUploading=function(){$("#croppingContainer").show(),n=document.getElementById("imageCroppingBox");var e=document.getElementById("profilePhotoUploader").files[0],a=URL.createObjectURL(e);d=new Croppie(n,{viewport:{width:150,height:150,type:"circle"},boundary:{width:200,height:200},showZoomer:!1}),d.bind({url:a,orientation:4})},e.destroyTheCropping=function(){d.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer").hide()},e.cancelAll=function(){$("#croppedImageViewer").hide(),$("#photoUploadingLabel").show(),e.imageFileObj={}},e.getCroppedImage=function(){d.result("base64").then(function(e){$("#croppedImageViewer img").attr("src",e)}),d.result("blob").then(function(a){e.imageFileObj=a}),d.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer, #photoUploadingLabel").hide(),$("#croppedImageViewer").show()},e.addAndUpdateEmp=function(){if(""!=e.membersObj.name&&null!=e.membersObj.name&&""!=e.membersObj.empId&&null!=e.membersObj.empId&&""!=e.membersObj.department&&null!=e.membersObj.department){a.separateLoaderIs=!0;var t=angular.copy(e.membersObj),r="";e.updateEmpDetailIs?(t.emp_id=t.id,r="updateEmployee"):r="createNewEmployee",o({method:"POST",url:e.rootURL+r,headers:{"Content-Type":"application/json"},data:t}).then(function(a){a.data.success?e.profileImageUploading(a.data.data,a.data.message):alert("Error :"+a.data.message)},function(e){a.separateLoaderIs=!1,console.log("error",e)})}else alert("Fill the all info...")},e.profileImageUploading=function(r,l){if(""!=e.imageFileObj.type&&null!=e.imageFileObj.type){var i="profile_image_"+r+".png",n=new File([e.imageFileObj],i),d=new FormData;d.append("File",n),d.append("emp_id",r),o.post(e.rootURL+"uploadImage",d,{transformRequest:angular.identity,headers:{"Content-Type":void 0},async:!1}).then(function(o){o.data.success?(alert(l),e.allMembersList=[],t(function(){e.getAllEmpList()},500),$("#memberAddModal").modal("hide")):alert(o.data.message),a.separateLoaderIs=!1},function(e){a.separateLoaderIs=!1,console.log("error",e)})}else alert(l),e.getAllEmpList(),$("#memberAddModal").modal("hide")},e.editAndAddEmp=function(a){e.imageFileObj={},"add"==a?(e.membersObj.name="",e.membersObj.empId="",e.membersObj.gender="male",e.membersObj.department="",e.updateEmpDetailIs=!1,$("#memberAddModal").modal("show")):(""!=a.image&&($("#croppedImageViewer img").attr("src",a.imageFullPath),$("#croppingContainer, #photoUploadingLabel").hide(),$("#croppedImageViewer").show()),e.updateEmpDetailIs=!0,e.membersObj=angular.copy(a),$("#memberAddModal").modal("show"))},e.deleteEmp=function(t){confirm("Do you want to delete this person?")&&(a.separateLoaderIs=!0,o({method:"GET",url:e.rootURL+"deleteEmployee?emp_id="+t,headers:{"Content-Type":"application/json"}}).then(function(a){a.data.success?(alert(a.data.message),e.getAllEmpList()):alert("Error :"+a.data.message)}))},$("#memberAddModal").on("hide.bs.modal",function(a){$("#profilePhotoUploader").val()&&(d.destroy(),e.imageFileObj={},$("#profilePhotoUploader").val(null)),$("#croppingContainer, #croppedImageViewer").hide(),$("#photoUploadingLabel").show()})}]);