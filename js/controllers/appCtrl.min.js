ngApp.controller("myCtrl",["$scope","$timeout","$http",function(e,o,t){var a,s;e.rootURL="http://192.168.1.135:8000/crud/",e.imageURL="http://192.168.1.135/myFirstNodeJs/uploads/",e.mainLoaderIs=!0,e.allMembersList=[],e.selMembersList=[],e.unSelMembersList=[],e.createdGroupList=[],e.checkRandomNo=[],e.membersCount=5,e.groupsCount=1,e.updateEmpDetailIs=!1,e.membersObj={name:"",empId:"",gender:"male",department:"",image:""},e.randomNoCreator=function(){for(var o=e.checkRandomNo,t=o.length;t--;){var a=o.splice(Math.floor(Math.random()*(t+1)),1)[0];return a}},e.autoCreateGroup=function(){for(var o=0;o<e.selMembersList.length;o++)e.checkRandomNo.push(o);for(var t=0;t<e.groupsCount;t++){for(var a=[],s=0;s<e.membersCount;s++){var r=0;if(!(a.length<e.membersCount))break;r=e.randomNoCreator(),a.push(e.selMembersList[r])}e.createdGroupList.push(a)}},e.reloadFun=function(o){"onload"==o?(e.mainLoaderIs=!0,e.createdGroupList=[],e.checkRandomNo=[],e.membersInGroup=[],e.selMembersList=[],t({method:"GET",url:e.rootURL+"getEmpList",headers:{"Content-Type":"application/json"}}).then(function(o){if(console.log("response",o),o.data.success){var t=o.data.data;for(let o=0;o<t.length;o++)""!=t[o].image&&(t[o].image=e.imageURL+t[o].image),1==t[o].status&&e.selMembersList.push(t[o]),e.allMembersList.push(t[o]);e.autoCreateGroup()}else alert("Error :"+o.data.message);e.mainLoaderIs=!1})):(e.createdGroupList=[],e.checkRandomNo=[],e.membersInGroup=[],e.autoCreateGroup())},e.memrsListViewOpenIs=!1,e.addMembersFromAll=function(){if(e.memrsListViewOpenIs)e.memrsListViewOpenIs=!1;else{e.unSelMembersList=[];for(var o=e.selMembersList.length-1,t=0;t<e.allMembersList.length;t++)if(e.selMembersList.length>0)for(var a=0;a<e.selMembersList.length&&e.allMembersList[t].id!=e.selMembersList[a].id;a++)a==o&&e.unSelMembersList.push(e.allMembersList[t]);else e.unSelMembersList.push(e.allMembersList[t]);e.memrsListViewOpenIs=!0}},e.removeFromSelList=function(o,a){var s={status:0,emp_id:0};"selList"==o&&(s.emp_id=a.id,e.unSelMembersList.push(a),e.selMembersList.splice(e.selMembersList.indexOf(a),1),s.status=0),"allList"==o&&(s.emp_id=a.id,e.selMembersList.push(a),e.unSelMembersList.splice(e.unSelMembersList.indexOf(a),1),s.status=1),"clearAll"==o&&(s.status="all",e.selMembersList=angular.copy(e.allMembersList)),t({method:"POST",url:e.rootURL+"changeEmpStatus",headers:{"Content-Type":"application/json"},data:s}).then(function(e){console.log("response",e),e.data.success?console.log(e.data.message):alert("Error :"+e.data.message)})},e.imageUplading=function(){$("#croppingContainer").show(),a=document.getElementById("imageCroppingBox");var e=document.getElementById("profilePhotoUploader").files[0],o=URL.createObjectURL(e);s=new Croppie(a,{viewport:{width:150,height:150,type:"circle"},boundary:{width:200,height:200},showZoomer:!1}),s.bind({url:o,orientation:4})},e.destroyTheCropping=function(){s.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer").hide()},e.cancelAll=function(){$("#croppedImageViewer").hide(),$("#photoUploadingLabel").show()},e.getCroppedImage=function(){s.result("blob").then(function(o){var a=e.membersObj.name.split(" "),s=a.join("_")+".png",r=new File([o],s);console.log("imageFile",r);var n=new FormData;n.append("File",r),n.append("emp_id",e.membersObj.id),n.append("name",e.membersObj.name),t.post(e.rootURL+"uploadImage",n,{transformRequest:angular.identity,headers:{"Content-Type":void 0},async:!1}).then(function(e){console.log("response",e),e.data.success},function(e){console.log("error",e)})}),s.destroy(),$("#profilePhotoUploader").val(null),$("#croppingContainer, #photoUploadingLabel").hide(),$("#croppedImageViewer").show()},e.addAndUpdateEmp=function(){e.mainLoaderIs=!0;var o=angular.copy(e.membersObj),a="";e.updateEmpDetailIs?(o.emp_id=o.id,a="updateEmployee"):a="createNewEmployee",t({method:"POST",url:e.rootURL+a,headers:{"Content-Type":"application/json"},data:o}).then(function(o){o.data.success?(alert(o.data.message),$("#memberAddModal").modal("hide"),e.reloadFun("onload")):alert("Error :"+o.data.message),e.mainLoaderIs=!1})},e.editAndAddEmp=function(o){"add"==o?(e.membersObj.name="",e.membersObj.empId="",e.membersObj.gender="male",e.membersObj.department="",e.membersObj.image="",e.updateEmpDetailIs=!1,$("#memberAddModal").modal("show")):(e.updateEmpDetailIs=!0,e.membersObj=angular.copy(o),$("#membersListModal").modal("hide"),$("#memberAddModal").modal("show"))},e.deleteEmp=function(o){confirm("Do you want to delete this person?")&&t({method:"GET",url:e.rootURL+"deleteEmployee?emp_id="+o,headers:{"Content-Type":"application/json"}}).then(function(o){o.data.success?(alert(o.data.message),e.reloadFun("onload")):alert("Error :"+o.data.message),e.mainLoaderIs=!1})},$("#memberAddModal").on("hide.bs.modal",function(e){$("#profilePhotoUploader").val()&&(s.destroy(),$("#profilePhotoUploader").val(null)),$("#croppingContainer, #croppedImageViewer").hide(),$("#photoUploadingLabel").show()}),o(function(){e.mainLoaderIs=!1},1e3)}]);